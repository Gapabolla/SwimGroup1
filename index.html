<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 10px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .admin-btn {
            display: none;
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            padding: 12px;
            text-decoration: none;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .admin-btn:hover {
            opacity: 0.9;
        }
        
        /* Оптимизируем iframe */
        iframe {
            width: 100%;
            height: 85vh;
            border: none;
            border-radius: 12px;
        }
        
        /* Скрываем лишние элементы Google Sheets */
        .table-container {
            overflow: hidden;
            position: relative;
        }
        
        /* Улучшаем загрузку */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--tg-theme-hint-color, #666);
        }
    </style>
</head>
<body>
    <!-- Кнопка редактирования для админа -->
    <a id="editBtn" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vRfKiesPxaRYiHMfRNT1NYa7H3th912IHJ1t2Mqt71Ht6oTXbyscLAQbtPzv7W3OrvuCy5qqYfS3Noq/edit" 
       class="admin-btn" target="_blank">
       ✏️ Редактировать таблицу
    </a>
    
    <!-- Контейнер для таблицы -->
    <div id="table-container">
        <div class="loading">Загрузка таблицы...</div>
    </div>

    <script>
        // === НАСТРОЙКИ ===
        const ADMIN_ID = 517194795; // ВАШ Telegram ID
        
        // Полная ссылка на таблицу
        const TABLE_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRfKiesPxaRYiHMfRNT1NYa7H3th912IHJ1t2Mqt71Ht6oTXbyscLAQbtPzv7W3OrvuCy5qqYfS3Noq/pubhtml?gid=0&single=true";
        
        // Ссылка для редактирования
        const EDIT_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRfKiesPxaRYiHMfRNT1NYa7H3th912IHJ1t2Mqt71Ht6oTXbyscLAQbtPzv7W3OrvuCy5qqYfS3Noq/edit";
        
        // === КОД ===
        const tg = window.Telegram.WebApp;
        
        // Расширяем на весь экран
        tg.expand();
        tg.ready();
        
        // Проверяем, админ ли это
        if (tg.initDataUnsafe.user && tg.initDataUnsafe.user.id == ADMIN_ID) {
            document.getElementById('editBtn').style.display = 'block';
            document.getElementById('editBtn').href = EDIT_URL;
        }
        
        // Функция загрузки таблицы
        function loadTable() {
            const container = document.getElementById('table-container');
            
            // Создаем оптимизированный iframe
            const iframe = document.createElement('iframe');
            
            // Добавляем параметры для ускорения и чистоты
            const optimizedUrl = TABLE_URL + 
                '&rm=minimal' +     // Минимальный интерфейс
                '&widget=false' +   // Без виджетов
                '&headers=false' +  // Без заголовков Google
                '&chrome=false';    // Без хрома
            
            iframe.src = optimizedUrl;
            iframe.loading = "lazy"; // Ленивая загрузка
            
            // Очищаем контейнер и добавляем iframe
            container.innerHTML = '';
            container.appendChild(iframe);
            
            // Скрываем loader через 2 секунды
            setTimeout(() => {
                const loadingDiv = document.querySelector('.loading');
                if (loadingDiv) {
                    loadingDiv.style.display = 'none';
                }
            }, 2000);
        }
        
        // Загружаем таблицу при открытии
        document.addEventListener('DOMContentLoaded', loadTable);
        
        // Автообновление каждые 60 секунд
        setInterval(() => {
            if (document.visibilityState === 'visible') {
                const iframe = document.querySelector('iframe');
                if (iframe) {
                    iframe.src = iframe.src; // Перезагружаем
                }
            }
        }, 60000);
        
        // Обновление при возвращении на вкладку
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                const iframe = document.querySelector('iframe');
                if (iframe) {
                    iframe.src = iframe.src;
                }
            }
        });
    </script>
</body>
</html>
